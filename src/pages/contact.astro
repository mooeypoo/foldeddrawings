---
import BaseLayout from '../layouts/BaseLayout.astro';
import siteConfig from '../data/site-config.json';
---

<BaseLayout title={`Contact Us - ${siteConfig.shopName}`} description={`Get in touch with ${siteConfig.shopName}`}>
	<section class="py-16 px-4">
		<div class="container mx-auto max-w-2xl">
			<h1 class="text-4xl md:text-5xl font-bold text-center mb-4 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">
				Contact Us
			</h1>
			<p class="text-center text-gray-600 mb-12">
				Have a question, suggestion, or need help? We'd love to hear from you!
			</p>

			<div class="bg-white rounded-xl shadow-lg p-8">
				<!-- Success message (hidden by default) -->
				<div id="form-success" class="hidden mb-6 p-4 bg-green-100 border border-green-400 text-green-700 rounded-lg">
					<p class="font-semibold">Thank you!</p>
					<p>Your message has been sent successfully. We'll get back to you soon!</p>
				</div>

				<!-- Error message (hidden by default) -->
				<div id="form-error" class="hidden mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
					<p class="font-semibold">Oops!</p>
					<p>Something went wrong. Please try again or email us directly.</p>
				</div>

				<form 
					name="contact"
					method="POST"
					data-netlify="true"
					data-netlify-honeypot="bot-field"
					class="space-y-6"
				>
					<!-- Hidden field for Netlify Forms -->
					<input type="hidden" name="form-name" value="contact" />
					
					<!-- Honeypot field for spam protection (hidden from users) -->
					<p class="hidden">
						<label>
							Don't fill this out if you're human: <input name="bot-field" />
						</label>
					</p>
					<div>
						<label for="name" class="block text-gray-700 font-semibold mb-2">
							Name
						</label>
						<input 
							type="text" 
							id="name" 
							name="name" 
							required
							class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
							placeholder="Your name"
						/>
					</div>

					<div>
						<label for="email" class="block text-gray-700 font-semibold mb-2">
							Email
						</label>
						<input 
							type="email" 
							id="email" 
							name="email" 
							required
							class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
							placeholder="your.email@example.com"
						/>
					</div>

					<div>
						<label for="subject" class="block text-gray-700 font-semibold mb-2">
							Subject
						</label>
						<input 
							type="text" 
							id="subject" 
							name="subject" 
							required
							class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
							placeholder="What's this about?"
						/>
					</div>

					<div>
						<label for="message" class="block text-gray-700 font-semibold mb-2">
							Message
						</label>
						<textarea 
							id="message" 
							name="message" 
							rows="6"
							required
							class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all resize-none"
							placeholder="Tell us what's on your mind..."
						></textarea>
					</div>

					<button 
						type="submit"
						class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300"
					>
						Send Message
					</button>
				</form>

				<div class="mt-8 pt-8 border-t border-gray-200">
					<p class="text-center text-gray-600">
						You can also reach us directly at{' '}
						<a 
							href={`mailto:${siteConfig.contactEmail}`}
							class="text-purple-600 hover:text-purple-700 font-semibold underline"
						>
							{siteConfig.contactEmail}
						</a>
					</p>
				</div>
			</div>
		</div>
	</section>

	<script>
		// Handle form submission with Netlify Forms
		const form = document.querySelector('form[name="contact"]') as HTMLFormElement;
		
		if (form) {
			form.addEventListener('submit', async (e) => {
				e.preventDefault();
				
				const formData = new FormData(form);
				const successMessage = document.getElementById('form-success');
				const errorMessage = document.getElementById('form-error');
				
				// Hide any previous messages
				if (successMessage) successMessage.classList.add('hidden');
				if (errorMessage) errorMessage.classList.add('hidden');
				
				// Convert FormData to URLSearchParams
				const params = new URLSearchParams();
				formData.forEach((value, key) => {
					params.append(key, value.toString());
				});
				
				try {
					const response = await fetch('/', {
						method: 'POST',
						headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
						body: params.toString()
					});
					
					if (response.ok) {
						// Show success message
						if (successMessage) successMessage.classList.remove('hidden');
						form.reset();
						
						// Scroll to success message
						successMessage?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
					} else {
						throw new Error('Form submission failed');
					}
				} catch (error) {
					// Show error message
					if (errorMessage) errorMessage.classList.remove('hidden');
					errorMessage?.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
				}
			});
		}
	</script>
</BaseLayout>
